<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>PostgreSQL 9.5 Coming To You Live</title>

		<meta name="description" content="PostgreSQL 9.5 Coming To You Live">
		<meta name="author" content="Keith Fiske - OmniTI, Inc">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/omniti.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <style>
            #li30 li { line-height:30px }
            .reveal .header {
                position: absolute;
                top: 1em;
                left: 1em;
                font-size: 0.4em;
                z-index: 1;
            }
        </style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
            <div class="header">
                <a href="#/cmdline">Cmdline</a>
            </div>

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
                <section data-background="css/theme/omniti_bg_logo.png">
                    TODO
                    <br>
Add the development schedule with when the commit fests are. See magnus's slides
<br>- Ask for help reviewing things in commitfest
<br>- Statistics
<br>- Go back and put script output as subslides to current subject (ex put upsert*.sql output in slides below upsert slide)


                </section>


                <section data-background="css/theme/omniti_bg_logo.png">
                    <section>
                        <h1>9.5 Coming To You Live</h1>
                        <h3>Upcoming PostgreSQL 9.5 Features</h3>
                        <p>
                            Presented by <a href="http://keithf4.com" target="_blank">Keith Fiske</a> / <a href="http://twitter.com/keithf4" target="_blank">@keithf4</a>
                        </p>
                        <p>
                        Database Administrator @ <a href="http://www.omniti.com" target="_blank">OmniTI</a>
                        </p>
                        <p><small>
                        <br/>
                        Follow along at <br/><a href="http://slides.keithf4.com/pg95live">http://slides.keithf4.com/pg95live</a>
                        <br />Script files located in repo 
                        <br /><a href="https://github.com/keithf4/pg95live" target="_blank">https://github.com/keithf4/pg95live</a>
                        </small></p>
                    </section>
                    <section id="cmdline">
                        <!-- Uncomment this iframe to activate shellinabox connection -->
                        <!-- <iframe src="https://localhost:4200" height="600" width="1200"></iframe> -->
                    </section>
                </section>
                
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>OmniTI, Inc</h2>
                    <ul>
                        <li>Full-stack support for high-traffic websites &amp; applications</li>
                        <li>Surge Conference</li>
                        <ul>
                            <li> <a href="http://omniti.com/surge">http://surge.omniti.com</a></li>
                            <li> Annually in Sept</li>
                        </ul>
                        <li>We're hiring!</li>
                        <ul>
                            <li><a href="http://omniti.com/is/hiring">http://omniti.com/is/hiring</a> - SysAdmins, DBAs, Developers</li>
                        </ul>
                        </ul>
                    <h2>Me!</h2>
                    <ul>
                        <li>Author of several third party PG Tools: pg_partman, pg_extractor, mimeo, pg_jobmon</li>
                    </ul>
                </section>
   
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>INSERT ... ON CONFLICT ... (UPSERT)</h2>
                    <ul>
                        <li>"... optimistic variant of regular insertion that first does a pre-check for existing tuples and then attempts an insert."</li>
                        <li>Similar to MERGE (arguably better)</li>
                        <li>ON CONFLICT...</li>
                        <ul>
                            <li>ON CONSTRAINT ... (better to name columns)</li>
                            <li>DO NOTHING</li>
                            <li>DO UPDATE SET ... [WHERE ...]</li>
                        </ul>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Row Level Security (RLS)</h2>
                    <ul>
                        <li>Per-row access policies</li>
                        <li>In addition to existing schema, table, column privileges</li>
                        <li>Superusers and object owners bypass RLS. Unless...</li>
                        <li>New GUC - row_security (ON, OFF, FORCE)</li>
                        <li>pg_dump sets row_securty to OFF (--enable-row-security)</li>
                        <li>Multiple policies per table (Results are OR'ed)</li>
                        <li>BYPASSRLS - new role property to allow individual roles to bypass RLS</li>
                        <li>Row level security shows up in the \d results</li>
                        <li>"Row Level Security" by Stephen Frost tomorrow @ 4pm in DMS 1140</li> 
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Checkpoint segments gone!</h2>
                    <ul>
                        <li>checkpoint_segments replaced by min_wal_size &amp; max_wal_size</li>
                        <ul>
                            <li>min_wal_size = 80MB (default)</li>
                            <li>max_wal_size = 128MB (default)</li>
                        </ul>
                        <li>Moving average of WAL segments (pg_xlogs) based on current activity</li>
                        <li>Checkpoints are auto-tuned to happen in between this size of WAL segments existing</li>
                        <li>Will only use up to max_wal_size if actually needed</li>
                        <li>If you set them the same, it gives you the same behavior as before</li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pg_rewind</h2>
                    <ul>
                        <li>Old failover steps</li>
                        <ol>
                            <li>Stop master (if it's still around)</li>
                            <li>Touch recovery trigger file on slave to make master</li>
                            <li>Rebuild old master from scratch as new slave</li>
                                <ul>
                                    <li>Rsync helped, but still not ideal for huge databases</li>
                                </ul>
                        </ol>
                    </ul>
                </section>
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pg_rewind</h2>
                    <ul>
                        <li>New failover steps!</li>
                        <ol>
                            <li>Stop master (if it's still around)</li>
                            <li>Touch recovery trigger file on slave to make master</li>
                            <li>pg_rewind on old master to resync with new master and become new slave</li>
                            <li>Connect new slave to new master</li>
                            <li>Do a little dance...</li>
                        </ol>
                        <li>Understands postgres file properties &amp; format so knows better than rsync how to reset old master.</li>
                        <li>Requires data checksum turned on (cluster init only) or wal_log_hints = on (requires restart)</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Foreign Table Inheritance</h2>
                    <ul>
                        <li>Foreign tables can how be inheritance children or parents</li>
                        <li>More options for partitioning &amp; sharding</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Import Foreign Schema</h2>
                    <ul>
                        <li>Create all tables in a defined FDW's schema as local foreign tables with a single command</li>
                        <li>"Transacting with foreign servers - Two's company, three is ..." by Ashutosh Bapat tomorrow @ 2pm in DMS 1160</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Grouping Sets</h2>
                    <ul>
                        <li>Aggregate data by different GROUP BY clauses at once</li>
                        <li>Previously achieved by conjoined UNION ALL statements</li>
                        <li>ROLLUP &amp; CUBE</li>
                        <li>Depesz does great job of explaining further<a href="http://www.depesz.com/2015/05/24/waiting-for-9-5-support-grouping-sets-cube-and-rollup/" target="_blank">on his blog</a></li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Multi-Column Sub-Select UPDATE</h2>
                    <ul>
                        <li>Update more than one column with subselect</li>
                        <li>Standard SQL Syntax</li>
                        <pre><code data-trim>
UPDATE tab SET (col1, col2) =
    (SELECT foo, bar FROM tab2)
WHERE ...
                        </pre></code>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>SKIP LOCKED</h2>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Numeric generate_series()</h2>
                    <ul>
                        <li>generate_series() could do int &amp; time already</li>
                        <li>Can now start &amp; end higher than int</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Arrays As Input To array_agg() and ARRAY()</h2>
                    <ul>
                        <li>Would previously throw errors when used on an array column</li>
                        <li>Now creates multi-dimensional array output</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Reduced Lock Levels</h2>
                    http://www.depesz.com/2015/04/23/waiting-for-9-5-reduce-lock-levels-of-some-trigger-ddl-and-add-fks/
- Reduce lock levels of some trigger DDL and add FKs.  Reduce lock
  levels to ShareRowExclusive for the following SQL CREATE TRIGGER
    (but not DROP or ALTER), ALTER TABLE ENABLE TRIGGER, ALTER TABLE
      DISABLE TRIGGER, and ALTER TABLE … ADD CONSTRAINT FOREIGN KEY
        Original work by Simon Riggs, extracted and refreshed by Andreas
          Karlsson New test cases added by Andreas Karlsson Reviewed by Noah
            Misch, Andres Freund, Michael Paquier and Simon Riggs
              http://git.postgresql.org/pg/commitdiff/0ef0396ae1687bf738d4703773d55467c36b2bcd


                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Toggle UNLOGGED</h2>
                    Beware turning off UNLOGGED on a large table
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>BRIN Indexes</h2>
                    http://www.depesz.com/2014/11/22/waiting-for-9-5-brin-block-range-indexes/
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>GiST Index-Only Scans</h2>
                    box &amp; point only
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Reindex Schema</h2>
                    http://www.depesz.com/2014/12/09/waiting-for-9-5-reindex-schema/
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Parallel vacuumdb</h2>
                    http://www.depesz.com/2015/01/26/waiting-for-9-5-vacuumdb-enable-parallel-mode/
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pg_xlogdump --stats</h2>
                    --stats argument. Figure out what's using up the space in the WAL log files to see what's causing the most activiy (DML, inserts, vacuum, etc) 
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>WAL compression</h2>
                    Pay CPU cost for saving IO cost
                    Only compresses full page images so still gzip them!
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>ALTER SYSTEM RESET</h2>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>TABLESAMPLE</h2>
                    http://www.depesz.com/2015/05/23/waiting-for-9-5-tablesample-sql-standard-and-extensible/
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pending_restart</h2>
                    http://www.depesz.com/2015/05/21/waiting-for-9-5-add-pg_settings-pending_restart-column/
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>recovery_target_action</h2>
                    What happens when slave catches up with WALs when coming out of recovery
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Cluster System Process Name</h2>
                    cluster_name in system process name. Useful in multi instance deployments
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Binary Dump Restore Feedback</h2>
                    Lets you know if you try and restore an -Fc dump with psql that you should instead use pg_restore
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Parallel Sequential Scan (possibly)</h2>
                    First step towards actual parallelized queries?
                    http://rhaas.blogspot.com/2015/03/parallel-sequential-scan-for-postgresql.html
                        - Robert has a dedicated talk for this. Go there!
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>How can you help?</h2>
                    <ul>
                        <li>Download 9.5 now! - <a href="https://github.com/postgres/postgres" target="_blank">https://github.com/postgres/postgres</a></li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h1>Thanks to</h1>
                    <ul>
                        <li>Magnus Hagander - For doing this talk in NYC before me already so I could steal it. </li>
                        <li>Hubert "Depesz" Lubaczewski - http://www.depesz.com - "Waiting For 9.5 ..." series.</li>
                        <li>Michael Paquier - http://michael.otacoo.com/ - "9.5 feature highlight ..." series
                        <li>Reveal.js - https://github.com/hakimel/reveal.js - For the awesome software this presentation was created in</li>
                    </ul>

                </section>


				

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                slideNumber: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
