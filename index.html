<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>PostgreSQL 9.5 Coming To You Live</title>

		<meta name="description" content="PostgreSQL 9.5 Coming To You Live">
		<meta name="author" content="Keith Fiske - OmniTI, Inc">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/omniti.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <style>
            #li30 li { line-height:30px }
            .reveal .header {
                position: absolute;
                top: 1em;
                left: 1em;
                font-size: 0.4em;
                z-index: 1;
            }
        </style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
            <div class="header">
                <a href="#/cmdline">Cmdline</a>
            </div>

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
                <section data-background="css/theme/omniti_bg_logo.png">
                    TODO
                    <br>
<br>- Go back and put script output as subslides to current subject (ex put upsert*.sql output in slides below upsert slide)


                </section>


                <section data-background="css/theme/omniti_bg_logo.png">
                    <section>
                        <h1>9.5 Coming To You Live</h1>
                        <h3>Upcoming PostgreSQL 9.5 Features</h3>
                        <p>
                            Presented by <a href="http://keithf4.com" target="_blank">Keith Fiske</a> / <a href="http://twitter.com/keithf4" target="_blank">@keithf4</a>
                        </p>
                        <p>
                        Database Administrator @ <a href="http://www.omniti.com" target="_blank">OmniTI</a>
                        </p>
                        <p><small>
                        <br/>
                        Follow along at <br/><a href="http://slides.keithf4.com/pg95live">http://slides.keithf4.com/pg95live</a>
                        <br />Script files located in repo 
                        <br /><a href="https://github.com/keithf4/pg95live" target="_blank">https://github.com/keithf4/pg95live</a>
                        </small></p>
                    </section>
                    <section id="cmdline">
                        <!-- Uncomment this iframe to activate shellinabox connection -->
                        <!-- <iframe src="https://localhost:4200" height="600" width="1200"></iframe> -->
                    </section>
                </section>
                
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>OmniTI, Inc</h2>
                    <ul>
                        <li>Full-stack support for high-traffic websites &amp; applications</li>
                        <li>Surge Conference</li>
                        <ul>
                            <li> <a href="http://omniti.com/surge">http://surge.omniti.com</a></li>
                            <li> Annually in Sept</li>
                        </ul>
                        <li>We're hiring!</li>
                        <ul>
                            <li><a href="http://omniti.com/is/hiring">http://omniti.com/is/hiring</a> - SysAdmins, DBAs, Developers</li>
                        </ul>
                        </ul>
                    <h2>Me!</h2>
                    <ul>
                        <li>Author of several third party PG Tools:<br />
                        <a href="https://github.com/keithf4/pg_partman" target="_blank">pg_partman</a>, <a href="https://github.com/omniti-labs/pg_extractor" target="_blank">pg_extractor</a>, <a href="https://github.com/omniti-labs/mimeo" target="_blank">mimeo</a>, <a href="https://github.com/omniti-labs/pg_jobmon" target="_blank">pg_jobmon</a></li>
                    </ul>
                </section>
   
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>INSERT ... ON CONFLICT ... (UPSERT)</h2>
                    <ul>
                        <li>"... optimistic variant of regular insertion that first does a pre-check for existing tuples and then attempts an insert."</li>
                        <li>Similar to MERGE (arguably better)</li>
                        <li>ON CONFLICT...</li>
                        <ul>
                            <li>ON CONSTRAINT ... (better to name columns)</li>
                            <li>DO NOTHING</li>
                            <li>DO UPDATE SET ... [WHERE ...]</li>
                        </ul>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Row Level Security (RLS)</h2>
                    <ul>
                        <li>Per-row access policies</li>
                        <li>In addition to existing schema, table, column privileges</li>
                        <li>Superusers and object owners bypass RLS. Unless...</li>
                        <li>New GUC - row_security (ON, OFF, FORCE)</li>
                        <li>pg_dump sets row_securty to OFF (--enable-row-security)</li>
                        <li>Multiple policies per table (Results are OR'ed)</li>
                        <li>BYPASSRLS/NOBYPASSRLS - new role property to allow individual roles to bypass RLS</li>
                        <li>Row level security shows up in the \d results</li>
                        <li>"Row Level Security" by Stephen Frost tomorrow @ 4pm in DMS 1140</li> 
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Checkpoint segments gone!</h2>
                    <ul>
                        <li>checkpoint_segments replaced by min_wal_size &amp; max_wal_size</li>
                        <ul>
                            <li>min_wal_size = 80MB (default)</li>
                            <li>max_wal_size = 128MB (default)</li>
                        </ul>
                        <li>Moving average of WAL segments (pg_xlogs) based on current activity</li>
                        <li>Checkpoints are auto-tuned to happen in between this size of WAL segments existing</li>
                        <li>Will only use up to max_wal_size if actually needed</li>
                        <li>If you set them the same, it gives you the same behavior as before</li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pg_rewind</h2>
                    <ul>
                        <li>Old failover steps</li>
                        <ol>
                            <li>Stop master (if it's still around)</li>
                            <li>Touch recovery trigger file on slave to make master</li>
                            <li>Rebuild old master from scratch as new slave</li>
                            <li>Pray your master stays up during long rebuild...</li>
                                <ul>
                                    <li>Rsync helped, but still not ideal for huge databases</li>
                                </ul>
                        </ol>
                    </ul>
                </section>
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pg_rewind</h2>
                    <ul>
                        <li>New failover steps!</li>
                        <ol>
                            <li>Stop master (if it's still around)</li>
                            <li>Touch recovery trigger file on slave to make master</li>
                            <li>pg_rewind on old master to resync with new master and become new slave</li>
                            <li>Connect new slave to new master</li>
                            <li>Do a little dance...</li>
                        </ol>
                        <li>Understands postgres file properties &amp; format so knows better than rsync how to reset old master.</li>
                        <li>Requires data checksum turned on (cluster init only) or wal_log_hints = on (requires restart)</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Foreign Table Inheritance</h2>
                    <ul>
                        <li>Foreign tables can how be inheritance children or parents</li>
                        <li>More options for partitioning &amp; sharding</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Import Foreign Schema</h2>
                    <ul>
                        <li>Create all tables in a defined FDW's schema as local foreign tables with a single command</li>
                        <li>"Transacting with foreign servers - Two's company, three is ..." by Ashutosh Bapat tomorrow @ 2pm in DMS 1160</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Grouping Sets</h2>
                    <ul>
                        <li>Aggregate data by different GROUP BY clauses at once</li>
                        <li>Previously achieved by conjoined UNION ALL statements</li>
                        <li>ROLLUP &amp; CUBE</li>
                        <li>Depesz does great job of explaining further <a href="http://www.depesz.com/2015/05/24/waiting-for-9-5-support-grouping-sets-cube-and-rollup/" target="_blank">on his blog</a></li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Multi-Column Sub-Select UPDATE</h2>
                    <ul>
                        <li>Update more than one column with subselect</li>
                        <li>Standard SQL Syntax</li>
                        <pre><code data-trim>
UPDATE tab SET (col1, col2) =
    (SELECT foo, bar FROM tab2)
WHERE ...
                        </pre></code>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Numeric generate_series()</h2>
                    <ul>
                        <li>generate_series() could do int &amp; time already</li>
                        <li>Can now start &amp; end higher than int</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Arrays As Input To array_agg() and ARRAY()</h2>
                    <ul>
                        <li>Would previously throw errors when used on an array column</li>
                        <li>Now creates multi-dimensional array output</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>SKIP LOCKED</h2>
                    <ul>
                        <li>Skip locked rows when using SELECT ... NOWAIT
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Reduced Lock Levels</h2>
                    <ul>
                        <li>Reduced lock levels (to ShareRowExclusive) for</li>
                        <ul>
                            <li>CREATE TRIGGER (not DROP or ALTER)</li>
                            <li>ALTER TABLE ENABLE TRIGGER</li>
                            <li>ALTER TABLE DISABLE TRIGGER</li>
                            <li>ALTER TABLE ... ADD CONSTRAINT FOREIGN KEY</li>
                        </ul>
                    </ul>
                </section>
               
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>BRIN Indexes</h2>
                    <ul>
                        <li>Block Range Index / MinMax Index</li>
                        <li>Stores only the bounds-per-heap-page vs BTree method of one index entry for each value</li>
                        <li>Configure how many heap pages contribute to index entry</li>
                        <li>Significantly faster index creation, update &amp; smaller size</li>
                        <li>Sometimes slower index searches than BTree</li>
                        <li>Works better with statically ordered data</li>
                        <li>Really good explanation &amp; examples at <a href="http://pythonsweetness.tumblr.com/post/119568339102/block-range-brin-indexes-in-postgresql-9-5" target="_blank">python sweetness blog</a></li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>GiST Index-Only Scans</h2>
                    <ul>
                        <li>Box &amp; Point data types only</li>
                        <li>Big improvement for geometric databases (PostGIS)</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Reindex Schema</h2>
                    <ul>
                        <li>REINDEX SCHEMA ...</li>
                        <li>Reindex all tables in a given schema</li>
                    </ul>
                </section>

                 <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Sorting Speed Improvement</h2>
                    <ul>
                        <li>Sorting used by CREATE INDEX, CLUSTER &amp; query plans much faster (3-4x) for text and numeric data</li>
                        <li>Abbreviated Keys</li>
                        <li>Exhaustive explanation on <a href="http://pgeoghegan.blogspot.com/2015/01/abbreviated-keys-exploiting-locality-to.html" target="_blank">Peter Geoghegan's Blog</a>
                    </ul>
                </section>
                 <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Toggle UNLOGGED</h2>
                    <ul>
                        <li>ALTER TABLE ... SET LOGGED / UNLOGGED</li>
                        <li>Beware changing on large tables (requires table rewrite)</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Parallel vacuumdb</h2>
                    <ul>
                        <li>Allows vacuumdb to open several server connections to vacuum or analyze several tables simultaneously.</li>
                        <li>--jobs=# (-j#)</li>
                        <li>Starts with largest tables first</li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pg_xlogdump</h2>
                    <ul>
                        <li>New --stats argument prints summary statstics for the contents of WAL files</li>
                        <li>--stats=record : generate per record instead of per resource manager</li>
                        <li>Figure out what's using up the space in the WAL log files to see what's causing the most activiy (DML, inserts, vacuum, etc) </li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>WAL compression</h2>
                    <ul>
                        <li>Smaller WAL files, faster replication</li>
                        <li>Pay CPU cost for saving IO &amp; disk space</li> 
                        <li>Only compresses full page images so still useful to gzip them</li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>ALTER SYSTEM RESET ... | ALL  </h2>
                    <ul>
                        <li>Reset to either postgresql.conf value or default if not explicitly set</li>
                        <li>ALTER SYSTEM RESET work_mem;</li>
                    </ul>
                </section>

               <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>recovery_target_action</h2>
                    <ul>
                        <li>Specify action the server should take once the recovery target is reached</li>
                        <li>pause, promote, shutdown</li>
                        <li>Pause is useful to check that system is at the desired recovery location. If not, change target settings then...</li>
                        <li>Paused state can be resumed by using pg_xlog_replay_resume(), which then causes recovery to end</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Cluster System Process Name</h2>
                    <ul>
                        <li>New postgresql.conf setting: cluster_name</li>
                        <li>Name shows up in process list</li>
                        <li>Useful when running multiple clusters on the same system</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Binary Dump Restore Feedback</h2>
                    <ul>
                        <li>psql lets you know if you try and restore an -Fc dump when you should instead use pg_restore</li>
                    </ul>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>Parallel Sequential Scan (possibly)</h2>
                    <ul>
                        <li>First step towards actual parallelized queries?</li>
                        <li>Robert Haas &amp; Amit Kapila have a dedicated talk for this tomorrow @ 1pm in DMS 1120</li>
                    </ul>
                </section>

<!--                
                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>TABLESAMPLE</h2>
                    http://www.depesz.com/2015/05/23/waiting-for-9-5-tablesample-sql-standard-and-extensible/
                </section>
-->
<!--                <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>pending_restart</h2>
                    http://www.depesz.com/2015/05/21/waiting-for-9-5-add-pg_settings-pending_restart-column/
                </section>
-->
                 <section data-background="css/theme/omniti_bg_logo.png">
                    <h2>How can you help?</h2>
                    <ul>
                        <li>CommitFest</li>
                        <ul>
                            <li>2015-06 is Open Now!</li>
                            <li>https://commitfest.postgresql.org</li>
                        </ul>
                        <li>Download, Compile, Install &amp; Test 9.5 now! - <a href="https://github.com/postgres/postgres" target="_blank">https://github.com/postgres/postgres</a></li>
                </section>

                <section data-background="css/theme/omniti_bg_logo.png">
                    <h1>Thanks to</h1>
                    <ul>
                        <li>Magnus Hagander - For doing this talk in NYC before me already so I could steal it. </li>
                        <li>Hubert "Depesz" Lubaczewski - http://www.depesz.com - "Waiting For 9.5 ..." series.</li>
                        <li>Michael Paquier - http://michael.otacoo.com/ - "9.5 feature highlight ..." series
                        <li>Reveal.js - https://github.com/hakimel/reveal.js - For the awesome software this presentation was created in</li>
                    </ul>

                </section>


				

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                slideNumber: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
